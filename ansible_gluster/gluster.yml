---
- hosts: dev
  tasks:
  - name: subscribe to RedHat repo
    redhat_subscription:
      state: present
      username: skandark@redhat.com
      password: travelxp@123
      pool_ids: 8a85f9815bb07800015bb08404d71143
  - name: Disable all repositories
    rhsm_repository:
      name: '*'
      state: disabled
  - name: Enable all repositories starting with rhel-7-server
    rhsm_repository:
      name: rhel-7-server-rpms
      state: enabled
  - name: Enable all repositories starting with rhel-gluster
    rhsm_repository:
      name: rh-gluster-3-for-rhel-7-server-rpms
      state: enabled
  - name: system update
    yum:
      name: '*'
      state: latest
  - name: Reboot system
    shell: "sleep5 && reboot"
    async: 1
    poll: 0
  - name: Wait for system to become reachable
    wait_for_connection:
      delay: 50
      timeout: 300
      connect_timeout: 20
  - name: install redhat storage server
    yum:
      name:  redhat-storage-server
      state: latest
